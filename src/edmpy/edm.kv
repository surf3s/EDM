#:kivy 1.1.0
#:set BUTTON_BACKGROUND (0, .69, 255/255, 1)
#:set BUTTON_COLOR (0, 0, 0, 1)
#:set MENU_COLOR [0, 0, 0]
#:set WINDOW_COLOR (0, 0, 0, 1)
#:set SUBMENU_COLOR (1, 1, 1, 1)

<MainScreen>:
    BoxLayout:
        id: mainbox
        orientation: 'vertical'
        BoxLayout:
            ActionView:
                size_hint_y : .1
                use_separator: True
                pos_hint: {'top': 1}
                background_image: 'white-bg.png'
                background_color: (.5, .5, .5, 1)
                background_normal: ''
                id: menu_bar
                ActionPrevious:
                    title: root.title
                    with_previous: False
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                ActionOverflow:
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                ActionGroup:
                    text: 'Help'
                    color: SUBMENU_COLOR
                    id: topmenu
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                    ActionButton:
                        text: 'Status'
                        on_press: app.root.current = 'StatusScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Log'
                        on_press: app.root.current = 'LogScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'CFG'
                        on_press: app.root.current = 'CFGScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'INI'
                        on_press: app.root.current = 'INIScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'JSON'
                        on_press: app.root.current = 'JSONScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'About'
                        on_press: app.root.current = 'AboutScreen'
                        color: SUBMENU_COLOR
                ActionGroup:
                    text: 'Delete'
                    color: SUBMENU_COLOR
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                    ActionButton:
                        text: 'The last point'
                        color: SUBMENU_COLOR
                        on_press: app.root.current = root.show_delete_last_record()
                        minimum_width: '140sp'
                    ActionButton:
                        text: 'The last object'
                        color: SUBMENU_COLOR
                        on_press: app.root.current = root.show_delete_last_object()
                    ActionButton:
                        text: 'All points'
                        color: SUBMENU_COLOR
                        on_press: app.root.current = root.show_delete_all_records()
                    ActionButton:
                        text: 'All datums'
                        color: SUBMENU_COLOR
                        on_press: app.root.current = root.show_delete_all_records('datums')
                    ActionButton:
                        text: 'All units'
                        color: SUBMENU_COLOR
                        on_press: app.root.current = root.show_delete_all_records('units')
                    ActionButton:
                        text: 'All prisms'
                        color: SUBMENU_COLOR
                        on_press: app.root.current = root.show_delete_all_records('prisms')
                ActionGroup:
                    text: 'Edit'
                    color: SUBMENU_COLOR
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                    ActionButton:
                        text: 'The last points'
                        color: SUBMENU_COLOR
                        on_press: app.root.current = 'EditLastRecordScreen'
                        minimum_width: '140sp'
                    ActionButton:
                        text: 'All Points'
                        on_press: app.root.current = 'EditPointsScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Datums'
                        on_press: app.root.current = 'EditDatumsScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Units'
                        on_press: app.root.current = 'EditUnitsScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Prisms'
                        on_press: app.root.current = 'EditPrismsScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Settings'
                        on_press: app.root.current = 'EDMSettingsScreen'
                        color: SUBMENU_COLOR
                ActionGroup:
                    text: 'Setup'
                    color: SUBMENU_COLOR
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                    ActionButton:
                        text: 'Configure Station'
                        on_press: app.root.current = 'StationConfigurationScreen'
                        color: SUBMENU_COLOR
                        minimum_width: '140sp'
                    ActionButton:
                        text: 'Test COM'
                        on_press: app.root.current = 'ComTestScreen'
                        color: SUBMENU_COLOR
                        minimum_width: '140sp'
                    ActionButton:
                        text: 'Initialize Station'
                        on_press: app.root.current = 'InitializeStationScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Verify Station'
                        on_press: app.root.current = 'VerifyStationScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Record Datums'
                        on_press: app.root.current = 'RecordDatumsScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Options'
                        on_press: app.root.current = 'OptionsScreen'
                        color: SUBMENU_COLOR
                ActionGroup:
                    text: 'File'
                    color: SUBMENU_COLOR
                    background_color: (.5, .5, .5, 1)
                    background_normal: ''
                    ActionButton:
                        text: 'Default CFG'
                        on_release: root.save_default_cfg()
                        color: SUBMENU_COLOR
                        minimum_width: '140sp'
                    ActionButton:
                        text: 'Open CFG'
                        on_release: root.show_load_cfg()
                        color: SUBMENU_COLOR
                        minimum_width: '140sp'
                    ActionButton:
                        text: 'Import'
                        on_release: root.show_import_csv()
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Export CSVs'
                        on_release: root.show_csv_datatype()
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Export GeoJSON'
                        on_release: root.show_save_geojson()
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Upload to Cloud'
                        on_press: app.root.current = 'UploadScreen'
                        color: SUBMENU_COLOR
                    ActionButton:
                        text: 'Exit'
                        #on_release: app.stop()
                        on_release: root.exit_program()
                        color: SUBMENU_COLOR


<e5_LoadDialog>:
    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        TextInput:
            size_hint: 1, None
            height: self.minimum_height
            readonly: True
            text: filechooser.path
            background_color: (0,0,0,0)
            foreground_color: (1,1,1,.8)
        FileChooserListView:
            id: filechooser
            filters: root.filters
            path: root.start_path
        BoxLayout:
            size_hint_y: None
            spacing: 5
            padding: 5
            Button:
                text: "Cancel"
                font_size: root.font_size
                on_release: root.cancel()
                color: root.button_color
                background_color: root.button_background
                background_normal: ''
            Button:
                text: "Open"
                font_size: root.font_size
                on_release: root.load(filechooser.path, filechooser.selection)
                color: root.button_color
                background_color: root.button_background
                background_normal: ''


#region code based on https://github.com/MichaelStott/DataframeGUIKivy/blob/master/dfguik.py

<DataGridHeaderCell>:
    size_hint: (None, None)
    text_size: self.size
    halign: "center"
    valign: "middle"
    height: '30dp'
    background_disabled_normal: ''
    disabled_color: (1, 1, 1, 1)
    color: (1, 1, 1, 1)
    canvas.before:
        Color:
            rgba: 0.165, 0.165, 0.165, 1
        Rectangle:
            pos: self.pos
            size: self.size
    on_release: root.parent.parent.parent.parent._generate_table(self.text)


<DataGridTableHeader>:
    header: header
    bar_width: 0
    do_scroll: False
    size_hint: (1, None)
    effect_cls: "ScrollEffect"
    height: '30dp'
    GridLayout:
        id: header
        rows: 1
        size_hint: (None, None)
        width: self.minimum_width
        height: self.minimum_height


<DataGridScrollCell>:
    canvas.before:
        #Color:
        #    rgba: root.datagrid_odd if root.is_even else root.datagrid_even
        Rectangle:
            pos: self.pos
            size: self.size
    text: root.text
    id: root.id
    on_press: root.callback(root.key, root.field, root.db)
    background_color: root.datagrid_even if root.is_even else root.datagrid_odd
    halign: "center"
    valign: "middle"
    # This setting determines if text wraps in the grid cell box
    text_size: self.size
    size_hint: 1, 1
    #height: 60
    #width: 400


<DataGridTableData>:
    rgrid: rgrid
    scroll_type: ['bars', 'content']
    bar_color: [0.2, 0.7, 0.9, 1]
    bar_inactive_color: [0.2, 0.7, 0.9, .5]
    do_scroll_x: True
    do_scroll_y: True
    effect_cls: "ScrollEffect"
    viewclass: "DataGridScrollCell"
    RecycleGridLayout:
        id: rgrid
        rows: root.nrows
        cols: root.ncols
        size_hint: (None, None)
        width: self.minimum_width
        height: self.minimum_height


<DataGridWidget>:
    panel1: data_frame_panel
    panel2: edit_panel
    panel3: delete_panel
    panel4: addnew_panel
    do_default_tab: False
    TabbedPanelItem:
        text: 'Data'
        on_release: root.open_panel1()
        background_normal: ''
        DataGridGridPanel:
            id: data_frame_panel
    TabbedPanelItem:
        text: 'Edit'
        background_normal: ''
        on_release: root.open_panel2()
        DataGridCasePanel:
            id: edit_panel
    TabbedPanelItem:
        text: 'Delete'
        background_normal: ''
        on_release: root.open_panel3()
        DataGridDeletePanel:
            id: delete_panel
    TabbedPanelItem:
        text: 'Add New'
        background_normal: ''
        on_release: root.open_panel4()
        DataGridAddNewPanel:
            id: addnew_panel
    TabbedPanelItem:
        text: 'Close'
        on_release: root.close_panels()
        background_normal: ''


<DataGridGridPanel>:
#    orientation: 'vertical'


<DataGridAddNewPanel>:
    addnew_list: addnew_list
#    orientation: 'vertical'
    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        size_hint: 1, 1
        scroll_timeout: 150
        GridLayout:
            id: addnew_list
            padding: "10sp"
            spacing: "5sp"
            cols:1
            row_default_height: '35dp'
            row_force_default: True
            size_hint_y: None

<DataGridCasePanel>:
    edit_list: edit_list
    orientation: 'vertical'
    ScrollView:
        do_scroll_x: False
        do_scroll_y: True
        size_hint: 1, 1
        scroll_timeout: 150
        GridLayout:
            id: edit_list
            padding: "10sp"
            spacing: "5sp"
            cols:1
            row_default_height: '35dp'
            row_force_default: True
            size_hint_y: None


<DataGridDeletePanel>:

#endregion end code from https://github.com/MichaelStott/DataframeGUIKivy/blob/master/dfguik.py
